
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="News Terminal"><meta name="keywords" content="curated, RSS, Breaking, News"><meta name="author" content="News Terminal">
    <title>News Terminal</title>
    <link href="data:image/x-icon;base64,AAABAAEAEBACAAAAAACwAAAAFgAAACgAAAAQAAAAIAAAAAEAAQAAAAAAQAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAACQAAAAAAAAAAAAADwDwAA+B8AAPw/AADsNwAAzDMAAMQjAADkJwAA4AcAAPAPAAD4HwAA8A8AAPAPAADwDwAA8A8AAPAPAADwDwAA" rel="icon" type="image/x-icon" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            color: #ff8800;
            font-family: 'Courier New', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.2;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: #000000;
            border-bottom: 2px solid #ff8800;
            padding: 15px 20px;
            margin-bottom: 0;
        }

        .header h1 {
            font-size: 18px;
            letter-spacing: 2px;
        }

        .status {
            font-size: 12px;
            margin-top: 5px;
            margin-bottom: 10px;
            color: #ff8800;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-text {
            display: flex;
            gap: 10px;
        }

        .status-details {
            display: inline;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .countdown {
            color: #ff8800;
            font-size: 11px;
        }

        @media (max-width: 768px) {
            .status-details {
                display: none;
            }
        }

        .live-indicator {
            width: 10px;
            height: 10px;
            background-color: #ff0000;
            border-radius: 50%;
            animation: pulse 2s infinite;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .live-indicator:hover {
            transform: scale(1.3);
        }

        .live-indicator:active {
            transform: scale(0.9);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.3;
                transform: scale(0.8);
            }
        }

        .search-box {
            width: 100%;
            padding: 8px 12px;
            background-color: #ff8800;
            color: #000000;
            border: none;
            font-family: 'Courier New', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            outline: none;
            box-sizing: border-box;
        }

        .search-box::placeholder {
            color: #333333;
        }

        .news-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 10px 20px;
        }

        .news-item {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 4px 0;
            border-bottom: 1px solid #333333;
            cursor: pointer;
            text-decoration: none;
            color: #ff8800;
            transition: background-color 0.2s;
        }

        .news-item:hover {
            background-color: #1a1a1a;
        }

        .news-item.breaking {
            background-color: #cc0000;
            color: #ffffff;
        }

        .news-item.breaking:hover {
            background-color: #990000;
        }

        .news-item.breaking .news-title,
        .news-item.breaking .news-source,
        .news-item.breaking .news-date {
            color: #ffffff;
        }

        .news-title {
            flex: 1;
            padding-right: 20px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 15px;
        }

        .news-meta {
            display: flex;
            gap: 15px;
            white-space: nowrap;
            font-size: 13px;
            flex-shrink: 0;
        }

        .news-source {
            color: #ff8800;
            font-weight: bold;
        }

        .news-date {
            color: #ff8800;
        }

        @media (max-width: 768px) {
            .news-date {
                display: none;
            }
            
            .news-meta {
                gap: 0;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .error {
            color: #ff0000;
            padding: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            body {
                font-size: 12px;
                padding: 10px;
            }

            .news-title {
                padding-right: 10px;
            }

            .news-meta {
                flex-direction: column;
                gap: 2px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="status">
            <div class="status-text">
                <span>LIVE</span>
                <span class="status-details" id="statusDetails"></span>
                <span id="statusTime"></span>
            </div>
            <div class="status-right">
                <span class="countdown" id="countdown">5:00</span>
                <div class="live-indicator"></div>
            </div>
        </div>
        <input type="text" class="search-box" id="searchBox" placeholder="SEARCH HEADLINES..." />
    </div>

    <div class="news-container" id="newsContainer">
        <div class="loading">LOADING FEEDS...</div>
    </div>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script src='https://storage.googleapis.com/feednami-static/js/feednami-client-v1.0.1.js'></script>
    <script>
        // RSS FEEDS CONFIGURATION
        const RSS_FEEDS = [
            { name: "REUTERS", url: "https://www.reutersagency.com/feed/", breaking: true },
            { name: "AFP", url: "https://www.afp.com/en/rss", breaking: true },
            { name: "AP", url: "https://feedx.net/rss/ap.xml", breaking: true },
            { name: "BBC-WORLD", url: "https://feeds.bbci.co.uk/news/world/rss.xml", breaking: true },
            { name: "BLOOMBERG-ED", url: "https://www.bloomberg.com/opinion/authors/ASB62QVt-d0/the-editors.rss", breaking: true },
            { name: "BLOOMBERG-MKT", url: "https://feeds.bloomberg.com/markets/news.rss", breaking: true },
            { name: "FT", url: "https://www.ft.com/news-feed?format=rss", breaking: true },
            { name: "FT-LEX", url: "http://www.ft.com/rss/lex", breaking: true },
            { name: "CNBC", url: "http://www.cnbc.com/id/100003114/device/rss/rss.html", breaking: true },
            { name: "CNBC-MKT", url: "https://www.cnbc.com/id/10000664/device/rss/rss.html", breaking: true },
            { name: "NPR", url: "https://www.npr.org/rss/rss.php?id=1004", breaking: true },
            { name: "LEVINE", url: "https://www.bloomberg.com/opinion/authors/ARbTQlRLRjE/matthew-s-levine.rss", breaking: true },
            { name: "BARRONS", url: "https://feeds.a.dj.com/rss/RSSMarketsMain.xml", breaking: true },
            { name: "FELDER", url: "https://www.thefelderreport.com/feed/", breaking: true },
            { name: "SEC", url: "https://www.sec.gov/news/pressreleases.rss", breaking: true },
            { name: "FED", url: "https://www.federalreserve.gov/feeds/press_all.xml", breaking: true },
            { name: "ECB", url: "https://www.ecb.europa.eu/rss/press.html", breaking: true },
            { name: "BLS", url: "https://www.bls.gov/feed/bls_latest.rss", breaking: true },
            { name: "CENSUS", url: "https://www.census.gov/economic-indicators/indicator.xml", breaking: true },
            { name: "BEA", url: "https://www.bea.gov/rss/rss.xml", breaking: true },
            { name: "TREASURY", url: "https://home.treasury.gov/about/general-information/news-release-feed", breaking: true },
            { name: "IMF", url: "https://www.imf.org/en/News/RSS/rss_news", breaking: true },
            { name: "WORLDBANK", url: "https://www.worldbank.org/en/news/all.rss", breaking: true },
            { name: "OECD", url: "https://www.oecd.org/newsroom/rss.xml", breaking: true },
            { name: "MARKETWATCH", url: "http://feeds.marketwatch.com/marketwatch/topstories/" },
            { name: "SEEKINGALPHA", url: "https://seekingalpha.com/market_currents.xml" },
            { name: "WSJ", url: "https://feeds.a.dj.com/rss/RSSWorldNews.xml" },
            { name: "NYT", url: "http://rss.nytimes.com/services/xml/rss/nyt/US.xml" },
            { name: "EURONEWS", url: "https://www.euronews.com/rss", breaking: true },
            { name: "FRANCE24", url: "https://www.france24.com/en/rss", breaking: true },
            { name: "ALJAZEERA", url: "https://www.aljazeera.com/xml/rss/all.xml", breaking: true },
            { name: "PIKETTY", url: "http://piketty.blog.lemonde.fr/feed/" },
            { name: "LAVIEDESIDEES", url: "http://www.laviedesidees.fr/spip.php?page=backend" },
            { name: "THEAGE", url: "http://www.theage.com.au/rssheadlines/top.xml" },
            { name: "LONGFORM", url: "http://longform.org/feed.rss" },
            { name: "ATLANTIC", url: "https://www.theatlantic.com/feed/best-of/" },
            { name: "NEWYORKER", url: "http://www.newyorker.com/feed/everything" },
            { name: "NYBOOKS", url: "http://feeds.feedburner.com/nybooks" },
            { name: "LRB", url: "https://www.lrb.co.uk/blog/feed" },
            { name: "PHILREVIEWS", url: "http://feeds2.feedburner.com/PhilosophicalReviews/News" },
            { name: "HARPERS", url: "http://harpers.org/feed/" },
            { name: "QUANTA", url: "https://www.quantamagazine.org/feed/" },
            { name: "SYMMETRY", url: "http://www.symmetrymagazine.org/feed" },
            { name: "EDGE", url: "https://www.edge.org/feed" },
            { name: "PROJSYNDICATE", url: "https://www.project-syndicate.org/rss" },
            { name: "GOOGLEBLOG", url: "https://googleblog.blogspot.ch/feeds/posts/default?alt=rss" },
            { name: "GATESNOTES", url: "http://www.gatesnotes.com/rss" },
            { name: "SALON", url: "http://www.salon.com/feed/" },
            { name: "INTERCEPT", url: "https://theintercept.com/feed/?rss" },
            { name: "VANITYFAIR", url: "https://www.vanityfair.com/feed/rss" },
            { name: "VOX", url: "https://www.vox.com/rss/index.xml" },
            { name: "CBS", url: "http://www.cbsnews.com/latest/rss/main" },
            { name: "SCIAM", url: "http://rss.sciam.com/ScientificAmerican-Global" },
            { name: "STRATECHERY", url: "http://stratechery.com/feed/" },
            { name: "PROPUBLICA", url: "http://feeds.propublica.org/propublica/main" },
            { name: "EVONOMICS", url: "http://evonomics.com/feed/" },
            { name: "AEON", url: "https://aeon.co/feed.rss" },
            { name: "AMPROSPECT", url: "https://prospect.org/api/rss/all.rss" },
            { name: "ATAVIST", url: "https://magazine.atavist.com/feed/" },
            { name: "MCSWEENEYS", url: "https://www.mcsweeneys.net/rss" },
            { name: "XKCD", url: "https://xkcd.com/rss.xml" },
            { name: "HACKERNEWS", url: "https://news.ycombinator.com/rss" },
            { name: "PHYSORG", url: "https://phys.org/rss-feed/breaking/" },
            { name: "WEBB", url: "https://webb-site.com/rss.asp" },
            { name: "SCIENCEMAG", url: "http://www.sciencemag.org/rss/news_current.xml" },
            { name: "TOI", url: "https://timesofindia.indiatimes.com/rssfeeds/296589292.cms" },
            { name: "SMH", url: "https://www.smh.com.au/rss/world.xml" },
            { name: "UNHERD", url: "https://unherd.com/feed/" },
            { name: "GLOBALTIMES", url: "http://www.globaltimes.cn/rss/outbrain.xml" },
            { name: "THECRITIC", url: "https://thecritic.co.uk/feed/" },
            { name: "CITATION", url: "https://www.citationneeded.news/rss/" },
            { name: "LEMONDE", url: "https://www.lemonde.fr/en/rss/une.xml" },
            { name: "TIME", url: "https://time.com/feed/" },
            { name: "DW", url: "https://rss.dw.com/rdf/rss-en-all", breaking: true },
            { name: "GUARDIAN", url: "https://www.theguardian.com/world/rss", breaking: true },
            { name: "INDEPENDENT", url: "https://www.independent.co.uk/news/world/rss", breaking: true }
        ];

        const newsContainer = document.getElementById('newsContainer');
        const statusDetails = document.getElementById('statusDetails');
        const statusTime = document.getElementById('statusTime');
        const countdownElement = document.getElementById('countdown');
        const liveIndicator = document.querySelector('.live-indicator');
        const searchBox = document.getElementById('searchBox');
        let allNewsItems = [];
        let displayedItemLinks = new Set(); // Track what's already displayed
        let loadedFeeds = 0;
        let totalFeeds = RSS_FEEDS.length;
        let searchQuery = '';
        let isInitialLoad = true;
        let secondsUntilRefresh = 300; // 5 minutes = 300 seconds
        let countdownInterval;

        // Countdown timer
        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            secondsUntilRefresh = 300;
            updateCountdownDisplay();
            
            countdownInterval = setInterval(() => {
                secondsUntilRefresh--;
                updateCountdownDisplay();
                
                if (secondsUntilRefresh <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        function updateCountdownDisplay() {
            const minutes = Math.floor(secondsUntilRefresh / 60);
            const seconds = secondsUntilRefresh % 60;
            countdownElement.textContent = `${minutes}:${String(seconds).padStart(2, '0')}`;
        }

        // Click red dot to trigger manual refresh
        liveIndicator.addEventListener('click', function() {
            console.log('Manual refresh triggered');
            // Set isInitialLoad to false to ensure smooth incremental update
            if (isInitialLoad && allNewsItems.length > 0) {
                isInitialLoad = false;
            }
            loadAllFeeds();
        });

        // Add search box event listener
        searchBox.addEventListener('input', function(e) {
            searchQuery = e.target.value.toLowerCase();
            displayNews(true); // Force full redraw on search
        });

        function capitalizeTitle(title) {
            const smallWords = ['a', 'an', 'and', 'as', 'at', 'but', 'by', 'for', 'from', 'in', 'into', 'near', 'nor', 'of', 'on', 'onto', 'or', 'the', 'to', 'with'];
            return title.toLowerCase().split(' ').map((word, index) => {
                if (index === 0 || !smallWords.includes(word)) {
                    return word.charAt(0).toUpperCase() + word.slice(1);
                }
                return word;
            }).join(' ');
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        function isWithin72Hours(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffHours = diffMs / (1000 * 60 * 60);
            return diffHours <= 72;
        }

        function createNewsItemElement(item) {
            const link = document.createElement('a');
            link.href = item.link;
            link.target = '_blank';
            link.className = 'news-item' + (item.breaking ? ' breaking' : '');
            link.dataset.link = item.link; // Store link for tracking
            
            const titleDiv = document.createElement('div');
            titleDiv.className = 'news-title';
            titleDiv.textContent = item.breaking ? item.title.toUpperCase() : capitalizeTitle(item.title);
            
            const metaDiv = document.createElement('div');
            metaDiv.className = 'news-meta';
            
            const sourceSpan = document.createElement('span');
            sourceSpan.className = 'news-source';
            sourceSpan.textContent = item.source;
            
            const dateSpan = document.createElement('span');
            dateSpan.className = 'news-date';
            dateSpan.textContent = formatDate(item.pubDate);
            
            metaDiv.appendChild(sourceSpan);
            metaDiv.appendChild(dateSpan);
            
            link.appendChild(titleDiv);
            link.appendChild(metaDiv);
            
            return link;
        }

        function displayNews(forceRedraw = false) {
            if (allNewsItems.length === 0) {
                newsContainer.innerHTML = '<div class="loading">LOADING FEEDS...</div>';
                statusDetails.textContent = '';
                statusTime.textContent = '';
                return;
            }

            // Filter by 72 hours and search query
            let filteredItems = allNewsItems.filter(item => isWithin72Hours(item.pubDate));
            
            if (searchQuery) {
                filteredItems = filteredItems.filter(item => 
                    item.title.toLowerCase().includes(searchQuery) || 
                    item.source.toLowerCase().includes(searchQuery)
                );
            }

            // ALWAYS sort by date (most recent first)
            filteredItems.sort((a, b) => b.pubDate - a.pubDate);

            // On initial load or forced redraw (search), rebuild everything
            // But only do full rebuild if we truly have no items displayed yet
            if ((isInitialLoad && displayedItemLinks.size === 0) || forceRedraw) {
                newsContainer.innerHTML = '';
                displayedItemLinks.clear();
                
                filteredItems.forEach(item => {
                    newsContainer.appendChild(createNewsItemElement(item));
                    displayedItemLinks.add(item.link);
                });
                
                if (loadedFeeds === totalFeeds) {
                    isInitialLoad = false;
                }
            } else {
                // Incremental update: only add new items at the top
                const newItems = filteredItems.filter(item => !displayedItemLinks.has(item.link));
                
                if (newItems.length > 0) {
                    // Sort new items by date
                    newItems.sort((a, b) => b.pubDate - a.pubDate);
                    
                    // Find the correct insertion point for each new item
                    const existingItems = Array.from(newsContainer.querySelectorAll('.news-item'));
                    
                    newItems.forEach(newItem => {
                        const newElement = createNewsItemElement(newItem);
                        displayedItemLinks.add(newItem.link);
                        
                        // Find first existing item older than the new item
                        let inserted = false;
                        for (let i = 0; i < existingItems.length; i++) {
                            const existingLink = existingItems[i].dataset.link;
                            const existingItem = allNewsItems.find(item => item.link === existingLink);
                            
                            if (existingItem && newItem.pubDate > existingItem.pubDate) {
                                newsContainer.insertBefore(newElement, existingItems[i]);
                                inserted = true;
                                break;
                            }
                        }
                        
                        // If newer than all existing items or no items yet
                        if (!inserted) {
                            newsContainer.appendChild(newElement);
                        }
                    });
                }
                
                // Clean up old items (older than 72 hours)
                const currentLinks = new Set(filteredItems.map(item => item.link));
                const existingElements = newsContainer.querySelectorAll('.news-item');
                existingElements.forEach(element => {
                    const link = element.dataset.link;
                    if (!currentLinks.has(link)) {
                        element.remove();
                        displayedItemLinks.delete(link);
                    }
                });
            }

            statusDetails.textContent = `- ${filteredItems.length} ITEMS FROM ${loadedFeeds}/${totalFeeds} SOURCES - `;
            statusTime.textContent = formatDate(new Date());
        }

        function loadAllFeeds() {
            const newItems = [];
            let feedsLoaded = 0;
            let updateTimeout;
            
            // For refresh, don't reset the display
            const isRefresh = !isInitialLoad;
            
            if (!isRefresh) {
                statusDetails.textContent = '- FETCHING FEEDS...';
                statusTime.textContent = '';
                newsContainer.innerHTML = '<div class="loading">LOADING FEEDS...</div>';
            }

            // Safety timeout: update display after 10 seconds even if not all feeds loaded
            updateTimeout = setTimeout(() => {
                if (feedsLoaded < RSS_FEEDS.length) {
                    console.log(`Timeout: Only ${feedsLoaded}/${RSS_FEEDS.length} feeds loaded, updating anyway`);
                    allNewsItems = newItems;
                    loadedFeeds = feedsLoaded;
                    displayNews();
                    startCountdown(); // Start countdown on timeout too
                }
            }, 10000);

            RSS_FEEDS.forEach(feed => {
                feednami.load(feed.url, function(result) {
                    feedsLoaded++;
                    
                    if (!result.error) {
                        const entries = result.feed.entries.slice(0, 50);
                        entries.forEach(entry => {
                            const pubDate = new Date(entry.date || entry.publishedDate || entry.updated || new Date());
                            // Only add if within 72 hours
                            if (isWithin72Hours(pubDate)) {
                                newItems.push({
                                    title: entry.title.replace(/<[^>]*>/g, '').trim(),
                                    link: entry.link,
                                    pubDate: pubDate,
                                    source: feed.name,
                                    breaking: feed.breaking || false
                                });
                            }
                        });
                    } else {
                        console.error(`Error loading ${feed.name}:`, result.error);
                    }
                    
                    // Progressive display during initial load
                    if (!isRefresh && newItems.length > 0) {
                        allNewsItems = [...newItems];
                        loadedFeeds = feedsLoaded;
                        displayNews();
                    }
                    
                    // When all feeds are loaded, do final update
                    if (feedsLoaded === RSS_FEEDS.length) {
                        clearTimeout(updateTimeout);
                        allNewsItems = newItems;
                        loadedFeeds = feedsLoaded;
                        displayNews();
                        startCountdown();
                    }
                });
            });
        }

        // Initial load
        loadAllFeeds();

        // Refresh every 5 minutes
        setInterval(loadAllFeeds, 5 * 60 * 1000);
    </script>
</body>
</html>
